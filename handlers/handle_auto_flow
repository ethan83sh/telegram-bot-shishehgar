# تغییر بازه زمانی
if context.user_data.get("awaiting_interval"):
    try:
        minutes = int(update.message.text)
        context.bot_data["auto_interval"] = minutes
        context.user_data.pop("awaiting_interval")
        await update.message.reply_text(f"بازه زمانی تغییر کرد به {minutes} دقیقه")

        # لغو Job قبلی و ایجاد Job جدید با بازه جدید
        start_time = context.bot_data.get("auto_start_time") or datetime.now()
        schedule_auto_job(context, start_time)
    except:
        await update.message.reply_text("لطفاً عدد صحیح وارد کن")
    return

# ریست زمان اولین پیام
if context.user_data.get("awaiting_reset"):
    try:
        h, m = map(int, update.message.text.split(":"))
        now = datetime.now()
        start_time = now.replace(hour=h, minute=m, second=0, microsecond=0)
        if start_time < now:
            start_time += timedelta(days=1)

        context.user_data.pop("awaiting_reset")
        schedule_auto_job(context, start_time)
        await update.message.reply_text(f"زمان اولین پیام ریست شد: {start_time.strftime('%Y-%m-%d %H:%M')}")
    except:
        await update.message.reply_text("فرمت اشتباه. مثال: 21:00")
    return
